<html>
  <head>
    <title>Enigma+ Rosetta Configuration</title>
  </head>
  <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
  <script>
var MAX_LANG = {
		0: 3, //v2.0 and below
		21: 7,
		22: 8
	},
	LANG_HUMAN = 0,
	DECODE_ALL = 7;
function getQueryParam(variable, defaultValue)
{
	// Something like this to get query variables.
	// Find all URL parameters
	var query = location.search.substring(1);
	var vars = query.split('&');
	for (var i = 0; i < vars.length; i++) {
		var pair = vars[i].split('=');

		// If the query variable parameter is found, decode it to use and return it for use
		if (pair[0] === variable) {
			return decodeURIComponent(pair[1]);
		}
	}
	return defaultValue || false;
}

function onSelectChanged()
{
	var lang = parseInt($("#lang_select").val(), 10);
	if (lang === LANG_HUMAN)
	{
		$("#decode_select").prop('disabled', true);
		$("#decode_select").val(DECODE_ALL);
	}
	else
	{
		$("#decode_select").prop('disabled', false);
	}
}

function onLoad()
{
	//parseInt returns NaN if not numeric
	var ver = parseInt(getQueryParam('ver'), 10),
		lang = parseInt(getQueryParam('lang'), 10),
		decode = parseInt(getQueryParam('decode'), 10),
		maxAllVersLangCnt = $("#lang_select option").length,
        i, maxVerLangCnt, selector;
    if (isNaN(ver))
    {
    	ver = 0;
    }
    maxVerLangCnt = MAX_LANG[ver];
    if (maxVerLangCnt === undefined)
    {
    	maxVerLangCnt = 3;
    }
	for (i = maxVerLangCnt; i < maxAllVersLangCnt; ++i)
	{
		$("#lang_select option[value='" + i + "']").remove();
	}
    selector = $("#lang_select option[value='" + lang + "']");
    if (selector.length > 0)
    {
    	selector.prop('selected', true);
    }
    selector = $("#decode_select option[value='" + decode + "']");
    if (selector.length > 0)
    {
    	selector.prop('selected', true);
    }
}
  </script>
  <body bgcolor="#47484B" onload="onLoad()">
    <font face="helvetica" color="white">
    <h2>Enigma+ Rosetta</h2>
    <h3><i>Choose Watch Face Settings</i></h3>

    <p>Language:
    <select id="lang_select"  onchange="onSelectChanged()">
<!--      <option value="-1">(Random every hour)</option> -->
      <option value="0">Human</option>
      <option value="1" selected>Klingon (Star Trek)</option>
      <option value="2">Aurebesh (Star Wars)</option>
      <option value="3">Aurebesh, Handwritten (Star Wars)</option>
      <option value="7">Betazed (Star Trek)</option>
      <option value="4">Graalen, Andorian (Star Trek)</option>
      <option value="5">Kentaurus, Greek (Star Trek)</option>
      <option value="6">Mandalorian (Star Wars)</option>
    </select>
    </p>

    <p>Decode alien text:
    <select id="decode_select">
      <option value="0">None</option>
      <option value="7">All</option>
      <option value="4" selected>Time only</option>
      <option value="6">Date &amp; Time only</option>
    </select>
    </p>

    <p>
    <button id="save_button">Save</button>
    </p>

    <script>
      //Setup to allow easy adding more options later
      function saveOptions() {
        var langSelect = document.getElementById("lang_select"),
            decodeSelect = document.getElementById("decode_select");
        var options = {
            lang: langSelect.options[langSelect.selectedIndex].value,
            decode: decodeSelect.options[decodeSelect.selectedIndex].value
        }

        return options;
      };
      var submitButton = document.getElementById("save_button");
      submitButton.addEventListener("click",
        function() {
          console.log("Submit");
          var options = saveOptions();
          var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(options));

          document.location = location;
        },
      false);
    </script>
  </body>
</html>